<!-- electronics/templates/electronics/product_detail.html -->
{% extends 'base/base.html' %}
{% load static %}
{% load i18n %}

{% block css %}
<link rel="stylesheet" href="{% static 'electronics/css/product_detail.css' %}">
{% endblock %}

{% block content %}
<div class="product-detail-container">
    <div class="product-image-section">
        {% if product.image %}
        <img src="{{ product.image.url }}" class="product-image" alt="{{ product.name }}">
        {% else %}
        <div class="image-placeholder">
            <i class="bi bi-image"></i>
        </div>
        {% endif %}
    </div>

    <div class="product-info-section">
        <h2>{{ product.name }}</h2>
        <span class="condition-tag {{ product.condition }}">
            {{ product.get_condition_display }}
        </span>

        <p class="product-description">{{ product.description }}</p>

        <div class="price-stock-section">
            <h3 class="price">${{ product.price }}</h3>
            <span class="stock-tag {% if product.stock > 0 %}in-stock{% else %}out-of-stock{% endif %}">
                {% if product.stock > 0 %}{{ product.stock }} in stock{% else %}Out of stock{% endif %}
            </span>
        </div>

        <div class="action-buttons">
            {% if user.is_authenticated and user != product.seller %}
                {% if product.stock > 0 %}
                <a href="{% url 'electronics:create_order' product.id %}" class="btn primary">
                    <i class="bi bi-cart-plus"></i> Buy Now
                </a>
                {% endif %}
                <a href="{% url 'electronics:add_review' product.id %}" class="btn secondary">
                    <i class="bi bi-star"></i> Review
                </a>
            {% elif user == product.seller %}
                <div class="btn-group">
                    <a href="{% url 'electronics:edit_product' product.id %}" class="btn outline-primary">
                        <i class="bi bi-pencil"></i> Edit
                    </a>
                    <a href="{% url 'electronics:delete_product' product.id %}" class="btn outline-danger">
                        <i class="bi bi-trash"></i> Delete
                    </a>
                </div>
            {% else %}
                <a href="{% url 'login' %}?next={% url 'electronics:product_detail' product.id %}" class="btn primary">
                    <i class="bi bi-cart-plus"></i> Login to Purchase
                </a>
            {% endif %}
        </div>

        <div class="seller-card">
            <h5>Seller Information</h5>
            <div class="seller-info">
                <i class="bi bi-person-circle"></i>
                <div>
                    <h6>{{ product.seller.username }}</h6>
                    <small>Member since {{ product.seller.date_joined|date:"M Y" }}</small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="product-reviews">
    <h4>Product Reviews</h4>

    {% if reviews %}
    <div class="review-list">
        {% for review in reviews %}
        <div class="review-item">
            <div class="review-header">
                <div class="review-user">
                    <strong>{{ review.user.username }}</strong>
                    <div class="review-stars">
                        {% for _ in "12345" %}
                            {% if forloop.counter <= review.rating %}
                            <i class="bi bi-star-fill"></i>
                            {% else %}
                            <i class="bi bi-star"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                <small class="review-date">{{ review.created_at|date:"M d, Y" }}</small>
            </div>
            <p class="review-comment">{{ review.comment }}</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-reviews">
        No reviews yet. Be the first to review!
    </div>
    {% endif %}
</div>
{% endblock %}

{% block js %}
<script src="{% static 'electronics/js/product_detail.js' %}"></script>
{% endblock %}
